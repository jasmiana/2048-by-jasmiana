# Python版2048游戏 (含AI自动玩家)

## 游戏介绍

2048是一款规则简单但富有挑战性的数字益智游戏。

- **游戏棋盘**: 在一个4×4的方格棋盘上进行。
- **操作方式**: 玩家可以选择上、下、左、右四个方向进行滑动。每次滑动，棋盘上所有的数字方块都会向选定方向移动，直到碰到边界或其他方块。
- **数字合并**: 如果两个相同数字的方块在滑动过程中相遇，它们会合并成一个数字为两者之和的新方块 (例如，两个2合并成4，两个4合并成8，以此类推)。每次合并都会为玩家增加相应的分数。
- **新方块生成**: 每次有效移动（即棋盘状态发生改变）后，会在棋盘的一个随机空格处生成一个新的数字方块，这个新方块有90%的概率是2，10%的概率是4。
- **游戏目标**: 通过不断合并数字，最终合成数字为2048的方块。达到2048后，玩家可以选择继续游戏以挑战更高分数。
- **游戏结束**: 当棋盘被数字填满，且无法再进行任何有效移动（即无法再合并任何方块）时，游戏结束。

## 如何运行

1.  确保你的计算机已安装Python (推荐Python 3.6或更高版本)。
2.  确保已安装Tkinter库 (大多数Python发行版会自带此库)。
3.  下载项目文件，并在项目根目录下运行以下命令启动游戏：

    ```bash
    python game_2048.py
    ```

    若您想试试人工智能是怎么玩游戏的，可在根目录下运行以下命令：
    ```bash
    python agent.py
    ```

-   若您的电脑上未安装Python，您可直接打开`dist`文件夹，并运行`play.exe`文件来玩游戏。

## 游戏控制

### 玩家手动控制
-   **方向键**: 使用键盘上的上(↑)、下(↓)、左(←)、右(→)箭头控制方块的移动。
-   **WASD键**: 或者使用W(上)、S(下)、A(左)、D(右)键进行控制。

### 游戏界面按钮
-   **新游戏**: 点击此按钮可以重置棋盘，开始一局全新的游戏。
-   **撤回**: 点击此按钮可以撤销上一步的移动操作，返回到之前的棋盘状态和分数（如果历史记录存在）。

### AI控制 (在`agent.py`运行时)
-   **启动AI**: 点击此按钮，AI将接管游戏，自动进行移动决策。
-   **停止AI**: 点击此按钮，AI将停止自动移动，玩家可以重新手动控制。

## 已完成功能

### 核心游戏逻辑 (`game_2048.py`)
-   [x] 完整的4x4棋盘2048游戏机制。
-   [x] 方块的滑动、合并与计分系统。
-   [x] 每次移动后随机生成新方块 (2或4)。
-   [x] 胜利条件检测 (合成2048)，并允许胜利后继续游戏。
-   [x] 失败条件检测 (棋盘填满且无法移动)。
-   [x] 基于Tkinter的图形用户界面 (GUI)。
-   [x] 根据方块数字动态变化的颜色和字体大小。
-   [x] 支持撤回上一步操作。

### AI智能代理 (`agent.py`)
-   [x] 实现了一个可以自动进行游戏决策的AI代理。
-   [x] AI通过图形界面按钮（启动AI/停止AI）进行控制。
-   [x] AI基于Expectimax算法进行决策。
-   [x] 包含一个启发式局面评估函数，综合考虑多种因素。
-   [x] 可配置的AI两步棋之间的思考/移动延迟 (`move_delay`)。

## AI算法简介 (`agent.py`)

本游戏中的AI主要采用 **Expectimax 算法** 来寻找最佳移动方向。

-   **Expectimax 算法**:
    这是一种用于在不确定环境下（如2048游戏中随机出现新方块）进行决策的算法。它结合了Max节点（AI做决策，选择最大化预期收益的移动）和Chance节点（环境做决策，如随机放置新方块，计算各种可能性的期望值）。AI会向前模拟几步，评估不同移动序列可能带来的局面。

-   **启发式局面评估函数 (`evaluate_position`)**:
    为了判断一个棋盘局面的好坏，AI使用了一个启发式评估函数，该函数综合以下几个方面给当前局面打分：
    1.  **位置权重 (`weight_matrix`)**: 棋盘上的不同位置被赋予不同的权重，通常鼓励将大数放在角落并形成蛇形排列。
        ```
        # 权重矩阵示例 (鼓励大数向右下角集中并蛇形排列)
        # [[2**3,  2**2,  2**1,  2**0 ],
        #  [2**4,  2**5,  2**6,  2**7 ],
        #  [2**11, 2**10, 2**9,  2**8 ],
        #  [2**12, 2**13, 2**14, 2**15]]
        ```
    2.  **空格数量**: 空格越多，通常意味着局面有更大的灵活性和潜力。
    3.  **可合并的方块对数量**: 当前局面下，相邻且相同的方块对越多，越容易通过合并来简化局面和得分。
    4.  **平滑度**: 棋盘上相邻方块之间的数值差异。差异越小，平滑度越高，通常是较好的局面，因为它减少了孤立的大数。
    5.  **单调性**: 鼓励行和列的数值保持单调递增或递减的趋势。这有助于方块的合并。
    6.  **最大方块值**: 棋盘上出现的最大方块值也会对评估分数有贡献。

-   **决策过程**:
    AI在每个决策点，会针对上、下、左、右四个可能的移动方向：
    1.  模拟执行该移动。
    2.  如果移动有效，则使用Expectimax算法递归地评估新局面（考虑到之后电脑随机生成新方块的各种可能性）。
    3.  选择那个能够带来最高期望评估分数的移动方向作为最佳移动。

## 文件说明

-   `game_2048.py`: 游戏的主程序，包含游戏逻辑、界面渲染和用户交互。
-   `agent.py`: AI代理的实现，包含AI算法、评估函数和AI控制逻辑。
-   `colors.py`: 定义了游戏中使用的各种颜色常量。
-   `README.md`: 本项目说明文档。

## 未来展望与改进方向

### 游戏体验增强
1.  **动画效果**: 为方块的移动和合并添加平滑的视觉动画效果。目前 `game_2048.py` 中有 `animate_move` 和 `combine_animation` 函数的雏形，但未在主移动逻辑中调用。
2.  **游戏状态保存与读取**: 允许玩家保存当前游戏进度，并在之后加载继续。
3.  **更高目标与挑战**: 引入4096、8192等更高的合并目标，增加游戏后期的挑战性。
4.  **计时模式**: 增加一种计时模式，挑战玩家在规定时间内的得分能力或达成目标的速度。
5.  **音效与音乐**: 添加背景音乐和方块移动、合并的音效，提升游戏沉浸感。
6.  **排行榜系统**: 实现本地高分排行榜，记录玩家的最佳成绩。

### AI能力提升
1.  **算法优化与扩展**:
    *   **搜索深度**: 增加Expectimax算法的搜索深度，可能会提高决策质量，但需注意性能开销。可以考虑迭代加深搜索。
    *   **Alpha-Beta剪枝**: `agent.py`中已有名为`alpha_beta`的函数，可以进一步优化并将其整合为AI的一种策略选项，或改进其在Expectimax框架下的剪枝效率。
2.  **评估函数调优**:
    *   **权重调整**: 细致调整评估函数中各项指标的权重，或引入新的启发式规则（如边缘大数惩罚等）。
    *   **机器学习**: 考虑使用强化学习或遗传算法等机器学习方法来自动学习和优化评估函数的参数。
3.  **AI可配置性**:
    *   允许用户在界面上选择不同的AI算法（如Expectimax vs 蒙特卡洛树搜索）或调整AI的难度级别（例如，通过改变搜索深度）。
4.  **AI决策可视化**:
    *   在游戏界面上直观地展示AI的思考过程，例如高亮显示AI正在评估的几个最佳移动及其预期分数，帮助理解AI决策。

### 创新功能探索
1.  **自定义游戏模式**:
    *   允许玩家自定义棋盘大小（例如3x3, 5x5）。
    *   允许设置初始棋盘布局或特殊障碍物。
2.  **多AI对战/协作**:
    *   创建一个模式，让两个不同的AI算法或配置进行对战。
    *   设计需要AI协作完成目标的模式。
3.  **AI教学与提示**:
    *   AI可以根据当前局面提供操作提示或潜在风险警告，作为教学工具。
4.  **主题与皮肤**:
    *   允许用户自定义游戏的颜色主题、方块样式等，增加个性化体验。
5.  **集成在线功能**:
    *   如果条件允许，可以考虑集成在线排行榜，与其他玩家比较分数。

## 游戏截图

![2af72c6b8896c21925e3f5e6e127f4e](https://github.com/user-attachments/assets/74441625-2c42-4b8f-ac28-892ea9688c73)
---

祝你游戏愉快！无论是亲自挑战2048，还是观察AI如何运筹帷幄！
